package aoUrnToRam::Test;

require kermeta
require "platform:/resource/aoUrnToRam/src/AoUrnToRamTransformation.kmt"
require "platform:/resource/aoUrnToRam/src/Util.kmt"

using kermeta::standard
using kermeta::kunit
using aoUrnToRam
using aoUrnToRam::util

class IntegrationTestCase inherits TestCase
{
	attribute sut:AoUrnToRamTransformation
	attribute projectFolderUri:String
	
	method setUp() is do
		//stle: would be nice if computed instead of hardcoded
		projectFolderUri:="file:///C:/Users/S/Files/H2012/Project/workspace"
		sut:=AoUrnToRamTransformation.new.initialize(dotAbsoluteFileUri,imgAbsoluteFileUri)
		sut.isIwFileOutputEnabled:=true
		sut.isRamStepViewAsDotOutputEnabled:=true
	end

/*stle: will pass once start nodes are implemented
	operation testSimple() is do
		parameterizableIntegrationTest("Simple.jucm")
	end
*/
	operation testTemp() is do
		parameterizableIntegrationTest("new_file.jucm")
	end

	operation testDemoSp5_WithAutSameConcern() is do
		parameterizableIntegrationTest("DemoSp5_WithAutSameConcern.jucm")
	end

	operation testDemoSp5_WithAutDifferentConcern() is do
		parameterizableIntegrationTest("DemoSp5_WithAutDifferentConcern.jucm")
	end
	
	operation testStubEntryExitIndexes() is do
		parameterizableIntegrationTest("StubEntryExitIndexes.jucm")
	end

	operation testOutboundStub() is do
		parameterizableIntegrationTest("OutboundStub.jucm")
	end

	operation parameterizableIntegrationTest(jucmSourceFileName:String) is do
		var sourceAbsoluteFileUri:String
		sourceAbsoluteFileUri:=Path.new.combine(integrationFolderUri,"jucm")
		sourceAbsoluteFileUri:=Path.new.combine(sourceAbsoluteFileUri,jucmSourceFileName)
		
		var destinationDirName:String init jucmSourceFileName.substring(0,jucmSourceFileName.size-4) 
		var destinationAbsoluteFileUri:String
		destinationAbsoluteFileUri:=Path.new.combine(integrationFolderUri,"actual")
		destinationAbsoluteFileUri:=Path.new.combine(destinationAbsoluteFileUri,destinationDirName)
		
		sut.transform(sourceAbsoluteFileUri,destinationAbsoluteFileUri)
	end
	
	property readonly integrationFolderUri:String
	getter is do
		result:=Path.new.combine(projectFolderUri,"aoUrnToRam/test/integration")
	end
	
	property readonly dotAbsoluteFileUri:String
	getter is do
		result:=Path.new.combine(projectFolderUri,"thridParty/Graphviz2.26.3/bin/dot.exe")
	end
	
	property readonly imgAbsoluteFileUri:String
	getter is do
		result:=Path.new.combine(projectFolderUri,"aoUrnToRam/img")
	end
	
	
	
}