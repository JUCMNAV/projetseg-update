package aoUrnToRam::test;

require "platform:/lookup/aoUrnToRam/test/tdd/iwToJavaInstantiator/TestHelper.kmt"

using kermeta::standard
using kermeta::kunit
using intermediateWorkflow
using javaInstantiator

class IwToJavaInstantiator_IwOrForkTestCase inherits TestCase,IwToJavaInstantiator_TestHelper
{
	reference sut:IwOrFork
	reference workflowInstantiator:WorkflowInstantiator

	method setUp() is do
		sut:=createIwOrFork
		sut.step:=createIwStep
		workflowInstantiator:=createWorkflowInstantiator
	end

	@feature "FeaWorkflowInstantiationWithoutStubs"
	operation testAppendBuildStatement_ShouldDeclareAndInitializeWorkflowNode() is do
		sut.jiAppendBuildStatement(workflowInstantiator)
		
		assertStringContains("    public ConditionalExecutionNode _theOrFork=new ConditionalExecutionNode();\n",workflowInstantiator.content)
	end

	@feature "FeaWorkflowInstantiationWithoutStubs"
	operation testAppendBuildStatement_ShouldInvokeAppendBuildStatementOnSuccs() is do
		withCondition(connectSource(sut))
		withCondition(connectSource(sut))
		
		sut.jiAppendBuildStatement(workflowInstantiator)
		
		assertStringContainsNTime(2,"public Condition ",workflowInstantiator.content)
	end
}
