package aoUrnToRam::test;

require "platform:/resource/aoUrnToRam/test/tdd/iwToJavaInstantiator/TestHelper.kmt"

using kermeta::standard
using kermeta::kunit
using intermediateWorkflow
using aoUrnToRam::util 
using javaInstantiator

class IwToJavaInstantiator_IwWorkflowTestCase inherits TestCase,IwToJavaInstantiator_TestHelper
{
	reference sut:IwWorkflow
	reference workflowInstantiator:WorkflowInstantiator
	
	method setUp() is do
		sut:=createIwWorkflowWithContainers
	end

	operation testToWorkflowInstantiator_ShouldInitWorkspacePath() is do
		workflowInstantiator:=sut.jiToWorkflowInstantiator
		
		assertEquals("Instantiators/theConcern/theWorkflowWorkflowInstantiator",workflowInstantiator.workspacePath)
	end
	
	operation testToWorkflowInstantiator_ShouldInitCustomizableClassSubPackage() is do
		workflowInstantiator:=sut.jiToWorkflowInstantiator
		
		assertEquals("theModel.Steps.theConcern",workflowInstantiator.customizableClassSubPackage)
	end
	

	operation testToWorkflowInstantiator_ShouldAppendPackage() is do
		workflowInstantiator:=sut.jiToWorkflowInstantiator
		
		assertStringStartsWith("package theModel.Instantiators.theConcern;\n\n",workflowInstantiator.content)
	end

	operation testToWorkflowInstantiator_ShouldAppendImports() is do
		workflowInstantiator:=sut.jiToWorkflowInstantiator
		
		assertStringContains( "import ram.reactiveworkflow.*;\n",workflowInstantiator.content)
		assertStringContains( "import ram.workflow.*;\n",workflowInstantiator.content)
	end

	operation testToWorkflowInstantiator_ShouldAppendClassPre() is do
		workflowInstantiator:=sut.jiToWorkflowInstantiator
		
		assertStringContains("\n\npublic class theWorkflowWorkflowInstantiator extends WorkflowInstantiator{",workflowInstantiator.content)
	end

	operation testToWorkflowInstantiator_ShouldAppendClassPost() is do
		workflowInstantiator:=sut.jiToWorkflowInstantiator
		
		assertStringEndsWith("}\n",workflowInstantiator.content)
	end


	operation testToWorkflowInstantiator_ShouldInvokeAppendBuildStatementOnNodes() is do
		createIwInput_Workflow(sut)
		createIwInput_Workflow(sut)
		
		workflowInstantiator:=sut.jiToWorkflowInstantiator
		
		assertStringContainsExpectedNTime("new",2,workflowInstantiator.content)
	end

	
}
