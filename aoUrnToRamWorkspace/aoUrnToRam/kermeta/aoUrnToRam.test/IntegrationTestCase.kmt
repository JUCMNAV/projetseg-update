package aoUrnToRam::test;

require kermeta
require "platform:/lookup/aoUrnToRam/kermeta/aoUrnToRam/AoUrnToRamTransformation.kmt"
require "platform:/lookup/aoUrnToRam/kermeta/Util.kmt"
require "platform:/lookup/aoUrnToRam/kermeta/PlateformResolver.kmt"

using kermeta::standard
using kermeta::persistence
using kermeta::kunit
using aoUrnToRam
using aoUrnToRam::util


class AoUrnToRam_IntegrationTestCase inherits TestCase,PlateformResolver
{
	attribute sut:AoUrnToRamTransformation
	attribute jucmSourceFileName:String

	@feature "FeaIntegrationTesting"
	operation testDemo2_Sp4_WithAutAspect() is do
		parameterizableIntegrationTest("Demo2_Sp4_WithAutAspect.jucm")
	end

	@feature "FeaIntegrationTesting"
	operation testSimple() is do
		parameterizableIntegrationTest("Simple.jucm")
	end

	@feature "FeaIntegrationTesting"
	operation testDemoSp5_WithAutSameConcern() is do
		parameterizableIntegrationTest("DemoSp5_WithAutSameConcern.jucm")
	end

	@feature "FeaIntegrationTesting"
	operation testDemoSp5_WithAutDifferentConcern() is do
		parameterizableIntegrationTest("DemoSp5_WithAutDifferentConcern.jucm")
	end

	@feature "FeaIntegrationTesting"
	operation testStartupNodeAndSharedResp() is do
		parameterizableIntegrationTest("StartupNodeAndSharedResp.jucm")
	end
	
	@feature "FeaIntegrationTesting"
	operation testOrJoin() is do
		parameterizableIntegrationTest("OrJoin.jucm")
	end

	operation parameterizableIntegrationTest(jucmSourceFileName:String) is do
		self.jucmSourceFileName:=jucmSourceFileName
		sut:=AoUrnToRamTransformation.new
		
		sut.transform(sourceAbsoluteFileUri,destinationAbsoluteFileUri,"true","true",aoUrnToRamPlateformUrl)

		stdio.writeln("For results, see "+destinationAbsoluteFileUri)
	end

	property readonly sourceAbsoluteFileUri:String 
	getter is do
		result:=Path.new.combine(integrationFolderUri,"jucm")
		result:=Path.new.combine(result,jucmSourceFileName)
	end
	
	property readonly destinationAbsoluteFileUri:String 
	getter is do
		var destinationDirName:String init jucmSourceFileName.substring(0,jucmSourceFileName.size-5) 
		result:=Path.new.combine(integrationFolderUri,"actual")
		result:=Path.new.combine(result,destinationDirName)
	end
	
	property readonly integrationFolderUri:String
	getter is do
		result:=resolvePlateformUrl(Path.new.combine(aoUrnToRamPlateformUrl,"kermeta/aoUrnToRam.test"))
	end
	
	property readonly aoUrnToRamPlateformUrl:String
	getter is do
		result:="platform:/resource/aoUrnToRam"
	end
	
}