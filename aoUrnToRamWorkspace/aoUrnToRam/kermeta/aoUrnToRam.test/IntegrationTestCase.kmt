package aoUrnToRam::test;

require kermeta
require "platform:/lookup/aoUrnToRam/kermeta/aoUrnToRam/AoUrnToRamTransformation.kmt"
require "platform:/lookup/aoUrnToRam/kermeta/Util.kmt"

using kermeta::standard
using kermeta::kunit
using aoUrnToRam
using aoUrnToRam::util

class Integration_IntegrationTestCase inherits TestCase
{
	attribute sut:AoUrnToRamTransformation
	attribute projectFolderUri:String
	
	method setUp() is do
		//stle: would be nice if computed instead of hardcoded
		projectFolderUri:="file:///C:/Users/S/Files/H2012/Project/workspace"
		sut:=AoUrnToRamTransformation.new.initialize(dotAbsoluteFileUri,imgAbsoluteFileUri)
		sut.isIwFileOutputEnabled:=true
		sut.isRamStepViewAsDotOutputEnabled:=true
	end

	operation testDemo2_Sp4_WithAutAspect() is do
		parameterizableIntegrationTest("Demo2_Sp4_WithAutAspect.jucm")
	end

	operation testSimple() is do
		parameterizableIntegrationTest("Simple.jucm")
	end

	operation testDemoSp5_WithAutSameConcern() is do
		parameterizableIntegrationTest("DemoSp5_WithAutSameConcern.jucm")
	end

	operation testDemoSp5_WithAutDifferentConcern() is do
		parameterizableIntegrationTest("DemoSp5_WithAutDifferentConcern.jucm")
	end
	
	operation testStartupNodeAndSharedResp() is do
		parameterizableIntegrationTest("StartupNodeAndSharedResp.jucm")
	end

	operation parameterizableIntegrationTest(jucmSourceFileName:String) is do
		var sourceAbsoluteFileUri:String
		sourceAbsoluteFileUri:=Path.new.combine(integrationFolderUri,"jucm")
		sourceAbsoluteFileUri:=Path.new.combine(sourceAbsoluteFileUri,jucmSourceFileName)
		
		var destinationDirName:String init jucmSourceFileName.substring(0,jucmSourceFileName.size-4) 
		var destinationAbsoluteFileUri:String
		destinationAbsoluteFileUri:=Path.new.combine(integrationFolderUri,"actual")
		destinationAbsoluteFileUri:=Path.new.combine(destinationAbsoluteFileUri,destinationDirName)
		
		sut.transform(sourceAbsoluteFileUri,destinationAbsoluteFileUri)
	end
	
	property readonly integrationFolderUri:String
	getter is do
		result:=Path.new.combine(projectFolderUri,"aoUrnToRam/kermeta/aoUrnToRam.test")
	end
	
	property readonly dotAbsoluteFileUri:String
	getter is do
		result:=Path.new.combine(projectFolderUri,"thirdParty/Graphviz2.26.3/bin/dot.exe")
	end
	
	property readonly imgAbsoluteFileUri:String
	getter is do
		result:=Path.new.combine(projectFolderUri,"aoUrnToRam/img")
	end
	
	
	
}