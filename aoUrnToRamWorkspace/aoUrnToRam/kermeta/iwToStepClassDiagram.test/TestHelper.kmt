package aoUrnToRam::test;

require kermeta
//stle: factory is common to IwToIw and IwToRam
require "platform:/lookup/aoUrnToRam/kermeta/iwToStepClassDiagram/_Ref.kmt"
require "platform:/lookup/aoUrnToRam/kermeta/testUtil/CustomAssert.kmt"
require "platform:/lookup/aoUrnToRam/kermeta/iw.testUtil/IwTestFactory.kmt"
require "platform:/lookup/aoUrnToRam/kermeta/Util.kmt"

using kermeta::standard
using kermeta::utils
using intermediateWorkflow
using ram

class IwToStepClassDiagram_TestHelper inherits CustomAssert,IwTestFactory
{
	operation createRamWorkspace():RamWorkspace is do
		result:=RamWorkspace.new
		result.aspectPerWorkspacePath:=Hashtable<String,Aspect>.new
		result.workflow:=createRamAspect("Workflow")
		result.customizableNode:=createRamClass("CustomizableNode")
		result.reactiveSystemWorkflow:=createRamAspect("ReactiveSystemWorkflow")
		result.inputData:=createRamClass("InputData")
		result.outputData:=createRamClass("OutputData")
	end
	
	operation createRamAspect(name:String):Aspect is do
		result:=Aspect.new
		result.name:=name
	end
	
	operation createRamClass(name:String):Class is do
		result:=Class.new
		result.name:=name
	end

	operation assertNumOfClassesWithoutBaseClasses(expectedNumOfClasses:Integer,actualIwStep:IwStep) is do
		assertEquals(expectedNumOfClasses,actualIwStep.ramAspect.structuralView.classes.select{ramClass|isBaseClass(ramClass)==false}.size)
	end
	
	operation isBaseClass(ramClass:Class):Boolean is do
		result:=ramClass.name=="OutputData" or ramClass.name=="InputData" 
	end
	
	operation setupAndExeLinkOnNode(node:IwNode):IwStep is do
		result:=createIwStep
		node.step:=result
		result.build
		
		node.link
	end
}